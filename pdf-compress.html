<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Compressor Tool</title>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            padding: 40px;
            position: relative;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #6a11cb, #2575fc);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .upload-container {
            border: 3px dashed #3498db;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            background: #f8f9fa;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .upload-container.drag-over {
            background: rgba(52, 152, 219, 0.1);
            border-color: #2c3e50;
        }
        
        .upload-container i {
            font-size: 4rem;
            color: #3498db;
            margin-bottom: 20px;
        }
        
        .upload-container h2 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .upload-container p {
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        
        .btn {
            background: linear-gradient(45deg, #6a11cb, #2575fc);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(37, 117, 252, 0.4);
            display: inline-block;
            margin: 10px 5px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(37, 117, 252, 0.6);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn.secondary {
            background: linear-gradient(45deg, #2ecc71, #1abc9c);
        }
        
        .progress-container {
            background: #f1f2f6;
            border-radius: 10px;
            padding: 20px;
            margin: 30px 0;
            display: none;
        }
        
        .progress-container.active {
            display: block;
        }
        
        .progress-bar {
            height: 15px;
            background: #dfe6e9;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #6a11cb, #2575fc);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            text-align: center;
            color: #7f8c8d;
            font-weight: 500;
        }
        
        .file-info {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }
        
        .file-info.active {
            display: flex;
        }
        
        .info-item {
            text-align: center;
            flex: 1;
        }
        
        .info-item h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .info-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #3498db;
        }
        
        .info-value.compressed {
            color: #2ecc71;
        }
        
        .download-container {
            text-align: center;
            display: none;
        }
        
        .download-container.active {
            display: block;
        }
        
        .file-input {
            display: none;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(52, 152, 219, 0.2);
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        
        .spinner.active {
            display: block;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .compression-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .option {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            flex: 1;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #e0e0e0;
        }
        
        .option.active {
            border-color: #3498db;
            background: rgba(52, 152, 219, 0.1);
        }
        
        .option h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .option p {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            .file-info {
                flex-direction: column;
                gap: 15px;
            }
            
            .compression-options {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PDF Compressor</h1>
            <p>Reduce your PDF file size without losing quality</p>
        </div>
        
        <div class="upload-container" id="dropZone">
            <i class="fas fa-file-pdf"></i>
            <h2>Drag & Drop your PDF here</h2>
            <p>or</p>
            <input type="file" id="fileInput" class="file-input" accept=".pdf">
            <button class="btn" id="browseBtn">Browse Files</button>
        </div>
        
        <div class="compression-options">
            <div class="option active" data-level="low">
                <h3>Low Compression</h3>
                <p>Small size reduction<br>Best quality</p>
            </div>
            <div class="option" data-level="medium">
                <h3>Medium Compression</h3>
                <p>Balance of size and quality</p>
            </div>
            <div class="option" data-level="high">
                <h3>High Compression</h3>
                <p>Maximum size reduction<br>Reduced quality</p>
            </div>
        </div>
        
        <div class="progress-container" id="progressContainer">
            <h3>Compressing your PDF...</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="progress-text" id="progressText">Starting compression process</p>
            <div class="spinner" id="spinner"></div>
        </div>
        
        <div class="file-info" id="fileInfo">
            <div class="info-item">
                <h3>Original Size</h3>
                <p class="info-value" id="originalSize">-</p>
            </div>
            <div class="info-item">
                <h3>Compressed Size</h3>
                <p class="info-value compressed" id="compressedSize">-</p>
            </div>
            <div class="info-item">
                <h3>Reduction</h3>
                <p class="info-value" id="reduction">-</p>
            </div>
        </div>
        
        <div class="download-container" id="downloadContainer">
            <button class="btn secondary" id="downloadBtn">
                <i class="fas fa-download"></i> Download Compressed PDF
            </button>
            <button class="btn" id="compressAnotherBtn">
                <i class="fas fa-redo"></i> Compress Another File
            </button>
        </div>
        
        <div class="footer">
            <p>All processing happens in your browser - your files are never uploaded to any server</p>
        </div>
    </div>

    <script>
        // DOM Elements
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const browseBtn = document.getElementById('browseBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const spinner = document.getElementById('spinner');
        const fileInfo = document.getElementById('fileInfo');
        const originalSize = document.getElementById('originalSize');
        const compressedSize = document.getElementById('compressedSize');
        const reduction = document.getElementById('reduction');
        const downloadContainer = document.getElementById('downloadContainer');
        const downloadBtn = document.getElementById('downloadBtn');
        const compressAnotherBtn = document.getElementById('compressAnotherBtn');
        const compressionOptions = document.querySelectorAll('.option');
        
        // Global variables
        let originalPdfBytes = null;
        let compressedPdfBytes = null;
        let currentCompressionLevel = 'low';
        
        // Initialize event listeners
        function init() {
            browseBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);
            
            // Drag and drop events
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('drag-over');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                
                if (e.dataTransfer.files.length) {
                    const file = e.dataTransfer.files[0];
                    if (file.type === 'application/pdf') {
                        processFile(file);
                    } else {
                        alert('Please select a PDF file.');
                    }
                }
            });
            
            // Compression options
            compressionOptions.forEach(option => {
                option.addEventListener('click', () => {
                    compressionOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    currentCompressionLevel = option.dataset.level;
                });
            });
            
            // Download button
            downloadBtn.addEventListener('click', downloadCompressedPdf);
            
            // Compress another button
            compressAnotherBtn.addEventListener('click', resetUI);
        }
        
        // Handle file selection
        function handleFileSelect(e) {
            if (e.target.files.length) {
                const file = e.target.files[0];
                processFile(file);
            }
        }
        
        // Process the selected PDF file
        async function processFile(file) {
            // Reset UI
            resetUI();
            
            // Update UI for processing
            progressContainer.classList.add('active');
            spinner.classList.add('active');
            progressText.textContent = 'Reading PDF file...';
            
            try {
                // Read file as ArrayBuffer
                const arrayBuffer = await readFileAsArrayBuffer(file);
                originalPdfBytes = new Uint8Array(arrayBuffer);
                
                // Display original file size
                const fileSizeMB = (originalPdfBytes.length / (1024 * 1024)).toFixed(2);
                originalSize.textContent = `${fileSizeMB} MB`;
                
                // Compress PDF
                progressText.textContent = 'Compressing PDF...';
                updateProgress(30);
                
                compressedPdfBytes = await compressPDF(originalPdfBytes, currentCompressionLevel);
                
                // Update progress
                updateProgress(80);
                progressText.textContent = 'Finalizing compression...';
                
                // Calculate file sizes
                const originalSizeMB = originalPdfBytes.length / (1024 * 1024);
                const compressedSizeMB = compressedPdfBytes.length / (1024 * 1024);
                const sizeReduction = ((1 - compressedSizeMB / originalSizeMB) * 100).toFixed(1);
                
                // Display results
                originalSize.textContent = `${originalSizeMB.toFixed(2)} MB`;
                compressedSize.textContent = `${compressedSizeMB.toFixed(2)} MB`;
                reduction.textContent = `${sizeReduction}%`;
                
                // Update UI
                updateProgress(100);
                setTimeout(() => {
                    progressContainer.classList.remove('active');
                    spinner.classList.remove('active');
                    fileInfo.classList.add('active');
                    downloadContainer.classList.add('active');
                }, 500);
                
            } catch (error) {
                console.error('Error compressing PDF:', error);
                progressText.textContent = 'Error compressing PDF. Please try another file.';
                setTimeout(() => {
                    progressContainer.classList.remove('active');
                    spinner.classList.remove('active');
                }, 2000);
            }
        }
        
        // Read file as ArrayBuffer
        function readFileAsArrayBuffer(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Compress PDF using pdf-lib
        async function compressPDF(pdfBytes, compressionLevel) {
            // Load the PDF document
            const { PDFDocument } = PDFLib;
            const pdfDoc = await PDFDocument.load(pdfBytes);
            
            // Set compression level
            let quality = 0.8;
            switch(compressionLevel) {
                case 'medium':
                    quality = 0.6;
                    break;
                case 'high':
                    quality = 0.4;
                    break;
            }
            
            // Save with compression options
            const compressedBytes = await pdfDoc.save({
                useObjectStreams: true,
                compress: true,
                // Note: pdf-lib doesn't directly support image compression quality settings
                // This is a conceptual representation
                imageQuality: quality
            });
            
            return compressedBytes;
        }
        
        // Download compressed PDF
        function downloadCompressedPdf() {
            if (!compressedPdfBytes) return;
            
            const blob = new Blob([compressedPdfBytes], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'compressed-document.pdf';
            document.body.appendChild(a);
            a.click();
            
            // Clean up
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
        }
        
        // Reset UI to initial state
        function resetUI() {
            progressFill.style.width = '0%';
            fileInfo.classList.remove('active');
            downloadContainer.classList.remove('active');
            originalPdfBytes = null;
            compressedPdfBytes = null;
            fileInput.value = '';
        }
        
        // Update progress bar
        function updateProgress(percent) {
            progressFill.style.width = `${percent}%`;
        }
        
        // Initialize application
        init();
    </script>
</body>
  </html>
